# Story 3.3: User Profile Social Presence & Friend System (Find/Request)

**Status:** Draft

## Story Statement
As a user,
I want to manage my social presence and find friends,
so that I can connect with my network on SynC.

## Acceptance Criteria
- User can see their own and friends' online/offline status.
- User can search for other users by name, contact, or email.
- User can send friend requests to other users.
- Users table is_online status is updated.
- Friends table is updated with user_id, friend_id, status ('pending').
- Local Testability: API endpoint POST /api/users/{user_id}/friends/request sends a friend request. Verification by querying SELECT status FROM public.Friends WHERE user_id = '{user_id}' AND friend_id = '{friend_id}'.

## Dev Notes
### Previous Story Insights
- User coupon collection and wallet are in place. [Source: docs/stories/3.2.story.md]

### Data Models
- Users table: is_online status. [Source: PRD]
- Friends table: user_id, friend_id, status ('pending'). [Source: PRD]

### API Specifications
- GET /api/users/search: Search for users by name, contact, or email. [Source: PRD]
- POST /api/users/{user_id}/friends/request: Send a friend request. [Source: PRD]
- GET /api/users/{user_id}/friends: Retrieve friend list and statuses. [Source: PRD]
- All API interactions must go through frontend API service layer (`apps/web/src/api/`). [Source: architecture/coding-standards.md]

### Component Specifications
- Social presence indicator (online/offline) for user and friends. [Source: PRD]
- User search interface. [Source: PRD]
- Friend request button and status display. [Source: PRD]

### File Locations
- Frontend pages: `apps/web/src/pages/friends.tsx`, `apps/web/src/pages/user-search.tsx`
- API service: `apps/web/src/api/friends.ts`, `apps/web/src/api/user-search.ts`
- Backend: `apps/api/src/users/` (serverless functions for friends and search)
[Source: architecture/unified-project-structure.md]

### Testing Requirements
- Frontend: Unit and integration tests for social presence, user search, and friend request UI. [Source: architecture/testing-strategy.md]
- Backend: Unit and integration tests for friends and search endpoints. [Source: architecture/testing-strategy.md]
- E2E: Playwright/Cypress tests for friend search and request flows. [Source: architecture/testing-strategy.md]

### Technical Constraints
- TypeScript for all codebases. [Source: architecture/tech-stack.md]
- Follow coding standards for API service layer, error handling, and naming conventions. [Source: architecture/coding-standards.md]
- State management for friends/social presence via React Context API/Zustand/Jotai. [Source: architecture/tech-stack.md]

## Tasks / Subtasks
1. Implement social presence indicator for user and friends. [Source: PRD]
2. Implement user search interface (by name, contact, email). [Source: PRD]
3. Implement friend request button and status display. [Source: PRD]
4. Implement backend endpoints for user search and friend requests. [Source: PRD]
5. Store and retrieve friend data in Friends table. [Source: PRD]
6. Update is_online status in Users table. [Source: PRD]
7. Add validation and error handling for friend requests and search. [Source: architecture/coding-standards.md]
8. Write unit/integration tests for frontend social presence, search, and friend request UI. [Source: architecture/testing-strategy.md]
9. Write unit/integration tests for backend friends and search endpoints. [Source: architecture/testing-strategy.md]
10. Write E2E tests for friend search and request flows. [Source: architecture/testing-strategy.md]
11. Verify all file locations and naming conventions match unified project structure. [Source: architecture/unified-project-structure.md]

## Project Structure Notes
- All files should be placed according to the unified project structure. [Source: architecture/unified-project-structure.md]
- No conflicts found between epic requirements and unified project structure.

---

Checklist: To be completed after draft review.
- [ ] All acceptance criteria addressed
- [ ] All technical context referenced
- [ ] Tasks/subtasks are actionable and referenced
- [ ] Project structure alignment verified
- [ ] Ready for developer implementation 