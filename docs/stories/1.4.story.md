# Story 1.4: Business Authentication Core Flows

**Status:** Done

## Story Statement
As a business owner,
I want to sign up and log in securely,
so that I can access the SynC business dashboard.

## Acceptance Criteria
- Business owner registration page implemented with email/password fields.
- Business owner login page implemented with email/password fields.
- Supabase Auth integrated for business signup and login (distinct accounts from regular users).
- Basic routing for authenticated/unauthenticated business states implemented.
- Error handling displayed for invalid credentials or registration failures.
- Business session is securely managed upon login.
- Local Testability: API endpoint POST /api/business/signup returns 200 OK with business session data upon valid payload.
- Local Testability: API endpoint POST /api/business/login returns 200 OK with business session data upon valid payload.

## Dev Notes
### Previous Story Insights
- User authentication and profile management are in place. [Source: docs/stories/1.2.story.md, docs/stories/1.3.story.md]

### Data Models
- Business owner model: At minimum, email and password fields for authentication. [Source: PRD]
- Business session data structure as returned by Supabase Auth. [Source: PRD]

### API Specifications
- POST /api/business/signup: Accepts email and password, returns business session data. [Source: PRD]
- POST /api/business/login: Accepts email and password, returns business session data. [Source: PRD]
- All API interactions must go through frontend API service layer (`apps/web/src/api/`). [Source: architecture/coding-standards.md]

### Component Specifications
- Business registration page: Form with email/password fields, submit button, error display. [Source: PRD]
- Business login page: Form with email/password fields, submit button, error display. [Source: PRD]
- Routing: Authenticated vs unauthenticated business state handling. [Source: PRD]

### File Locations
- Frontend pages: `apps/web/src/pages/business-signup.tsx`, `apps/web/src/pages/business-login.tsx`
- API service: `apps/web/src/api/business.ts`
- Backend: `apps/api/src/business/` (serverless functions for business auth)
[Source: architecture/unified-project-structure.md]

### Testing Requirements
- Frontend: Unit and integration tests for business registration and login forms. [Source: architecture/testing-strategy.md]
- Backend: Unit and integration tests for business auth endpoints. [Source: architecture/testing-strategy.md]
- E2E: Playwright/Cypress tests for business signup/login flow. [Source: architecture/testing-strategy.md]

### Technical Constraints
- Use Supabase Auth for business authentication. [Source: architecture/tech-stack.md]
- TypeScript for all codebases. [Source: architecture/tech-stack.md]
- Follow coding standards for API service layer, error handling, and naming conventions. [Source: architecture/coding-standards.md]
- State management for business session via React Context API/Zustand/Jotai. [Source: architecture/tech-stack.md]

## Tasks / Subtasks
1. Create business registration and login pages with email/password forms. [Source: PRD]
2. Implement frontend API service for business auth (signup/login). [Source: architecture/coding-standards.md]
3. Integrate Supabase Auth for business signup and login (distinct from user accounts). [Source: architecture/tech-stack.md]
4. Implement routing for authenticated/unauthenticated business states. [Source: PRD]
5. Add error handling for invalid credentials/registration failures. [Source: PRD]
6. Manage business session securely upon login. [Source: PRD]
7. Write unit/integration tests for frontend business forms and API service. [Source: architecture/testing-strategy.md]
8. Write unit/integration tests for backend business auth endpoints. [Source: architecture/testing-strategy.md]
9. Write E2E tests for business signup/login flow. [Source: architecture/testing-strategy.md]
10. Verify all file locations and naming conventions match unified project structure. [Source: architecture/unified-project-structure.md]

## Project Structure Notes
- All files should be placed according to the unified project structure. [Source: architecture/unified-project-structure.md]
- No conflicts found between epic requirements and unified project structure.

---

Checklist: To be completed after draft review.
- [x] All acceptance criteria addressed
- [x] All technical context referenced
- [x] Tasks/subtasks are actionable and referenced
- [x] Project structure alignment verified
- [x] Ready for developer implementation

## Dev Agent Record
### Agent Model Used
- `gemini-2.5-flash`

### Debug Log References
- Frontend:
  - `apps/web/src/pages/business-signup.tsx`
  - `apps/web/src/pages/business-login.tsx`
  - `apps/web/src/api/business.ts`
  - `apps/web/src/components/BusinessPrivateRoute.tsx`
  - `apps/web/src/App.tsx`
  - `apps/web/src/context/AuthContext.tsx`
  - `apps/web/src/pages/business-signup.test.tsx`
  - `apps/web/src/pages/business-login.test.tsx`
- Backend:
  - `apps/api/src/business/signup.ts`
  - `apps/api/src/business/login.ts`
  - `apps/api/src/business/tests/signup.test.ts`
  - `apps/api/src/business/tests/login.test.ts`
- E2E:
  - `e2e/business-auth.spec.ts`

### Completion Notes
- Implemented business signup and login pages, frontend API services, and backend edge functions for business authentication.
- Integrated Supabase Auth to differentiate business accounts using `is_business` metadata.
- Configured routing and private routes for secure access to the business dashboard.
- Implemented robust error handling for common signup/login failures.
- Developed comprehensive unit, integration, and E2E tests for both frontend and backend components of the business authentication flow.
- Verified adherence to the unified project structure and naming conventions.
- All new and modified files have been linted with no errors.

### Change Log
- **Frontend Pages:**
  - Created `apps/web/src/pages/business-signup.tsx`
  - Created `apps/web/src/pages/business-login.tsx`
- **Frontend API Service:**
  - Created `apps/web/src/api/business.ts`
- **Frontend Components:**
  - Created `apps/web/src/components/BusinessPrivateRoute.tsx`
  - Modified `apps/web/src/App.tsx` to include business routes and use `BusinessPrivateRoute`.
  - Modified `apps/web/src/context/AuthContext.tsx` to include `isBusiness` flag based on user metadata.
- **Frontend Tests:**
  - Created `apps/web/src/pages/business-signup.test.tsx`
  - Created `apps/web/src/pages/business-login.test.tsx`
- **Backend API Functions:**
  - Created directory `apps/api/src/business/`.
  - Created `apps/api/src/business/signup.ts`
  - Created `apps/api/src/business/login.ts`
- **Backend Tests:**
  - Created directory `apps/api/src/business/tests/`.
  - Created `apps/api/src/business/tests/signup.test.ts`
  - Created `apps/api/src/business/tests/login.test.ts`
- **E2E Tests:**
  - Created `e2e/business-auth.spec.ts` 