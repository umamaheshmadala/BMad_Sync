# Story 4.1: Business Analytics Dashboard (Coupons & Reviews Summary)

**Status:** Approved

## Story Statement
As a business owner,
I want to view weekly summaries of my customer reviews and coupon utilization,
so that I can understand customer engagement and the effectiveness of my offers.

## Acceptance Criteria
- Business owner can access a dedicated analytics dashboard.
- Dashboard displays daily, weekly, quarterly, and custom period summarized customer reviews, indicating counts for "recommend" and "don't recommend".
- Dashboard displays weekly summarized coupon utilization, including number of coupons redeemed and overall redemption rate.
- Analytics data is calculated and viewable per store, per business category, and can consider other demographics or locations.
- Data from BusinessReviews and UserCoupons tables (specifically is_redeemed status) is accurately used for calculations.
- Local Testability: API endpoint GET /api/business/{business_id}/analytics/reviews returns review summaries. Verification by querying SELECT recommend_status, review_text FROM public.BusinessReviews WHERE business_id = '{business_id}'.
- Local Testability: API endpoint GET /api/business/{business_id}/analytics/coupons returns coupon utilization summaries. Verification by querying SELECT is_redeemed FROM public.UserCoupons JOIN public.Coupons ON UserCoupons.coupon_id = Coupons.coupon_id WHERE Coupons.business_id = '{business_id}'.

## Dev Notes
### Previous Story Insights
- Business storefront, offers, and coupon management are in place. [Source: docs/stories/2.1.story.md, docs/stories/3.1.story.md]

### Data Models
- BusinessReviews table: business_id, recommend_status, review_text, created_at. [Source: PRD]
- UserCoupons table: is_redeemed, coupon_id, user_id, collected_at, redeemed_at. [Source: PRD]

### API Specifications
- GET /api/business/{business_id}/analytics/reviews: Returns review summaries. [Source: PRD]
- GET /api/business/{business_id}/analytics/coupons: Returns coupon utilization summaries. [Source: PRD]
- All API interactions must go through frontend API service layer (`apps/web/src/api/`). [Source: architecture/coding-standards.md]

### Component Specifications
- Analytics dashboard UI: Review summaries, coupon utilization, period selectors, filters by store/category/demographics. [Source: PRD]

### File Locations
- Frontend pages: `apps/web/src/pages/business-analytics-dashboard.tsx`
- API service: `apps/web/src/api/business-analytics.ts`
- Backend: `apps/api/src/business/` (serverless functions for analytics)
[Source: architecture/unified-project-structure.md]

### Testing Requirements
- Frontend: Unit and integration tests for analytics dashboard UI. [Source: architecture/testing-strategy.md]
- Backend: Unit and integration tests for analytics endpoints. [Source: architecture/testing-strategy.md]
- E2E: Playwright/Cypress tests for analytics dashboard flows. [Source: architecture/testing-strategy.md]

### Technical Constraints
- TypeScript for all codebases. [Source: architecture/tech-stack.md]
- Follow coding standards for API service layer, error handling, and naming conventions. [Source: architecture/coding-standards.md]
- State management for analytics dashboard via React Context API/Zustand/Jotai. [Source: architecture/tech-stack.md]
- Analytics calculations must be efficient and scalable. [Source: PRD]

## Tasks / Subtasks
1. Implement analytics dashboard UI for business owners. [Source: PRD]
2. Implement backend endpoints for review and coupon analytics. [Source: PRD]
3. Aggregate and calculate review and coupon utilization data from BusinessReviews and UserCoupons tables. [Source: PRD]
4. Add period selectors and filters for store/category/demographics. [Source: PRD]
5. Add validation and error handling for analytics data. [Source: architecture/coding-standards.md]
6. Write unit/integration tests for frontend analytics dashboard. [Source: architecture/testing-strategy.md]
7. Write unit/integration tests for backend analytics endpoints. [Source: architecture/testing-strategy.md]
8. Write E2E tests for analytics dashboard flows. [Source: architecture/testing-strategy.md]
9. Verify all file locations and naming conventions match unified project structure. [Source: architecture/unified-project-structure.md]

## Project Structure Notes
- All files should be placed according to the unified project structure. [Source: architecture/unified-project-structure.md]
- No conflicts found between epic requirements and unified project structure.

---

Checklist: To be completed after draft review.
- [ ] All acceptance criteria addressed
- [ ] All technical context referenced
- [ ] Tasks/subtasks are actionable and referenced
- [ ] Project structure alignment verified
- [ ] Ready for developer implementation 