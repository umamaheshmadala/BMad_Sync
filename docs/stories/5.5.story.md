# Story 5.5: User Profile Activity Sharing Control

**Status:** Draft

## Story Statement
As a user,
I want to control which of my activities are shared,
so that I can manage my privacy.

## Acceptance Criteria
- User can choose to share or keep private their own activity in the activity feed, except for coupon sharing activity.
- Coupon sharing activity cannot be opted out of, though a user can choose not to receive shared coupons until they accept them.
- Users table privacy_settings JSONB field stores preferences for general activity sharing (e.g., check-ins, coupon redemptions for self-use, reviews, ad interactions).
- Local Testability: API endpoint PUT /api/users/{user_id}/privacy/activity updates activity sharing settings. Verification by querying SELECT privacy_settings FROM public.Users WHERE user_id = '{user_id}'.

## Dev Notes
### Previous Story Insights
- Notification preferences and control are in place. [Source: docs/stories/5.4.story.md]

### Data Models
- Users table: privacy_settings JSONB field for activity sharing preferences. [Source: PRD]

### API Specifications
- PUT /api/users/{user_id}/privacy/activity: Updates activity sharing settings. [Source: PRD]
- All API interactions must go through frontend API service layer (`apps/web/src/api/`). [Source: architecture/coding-standards.md]

### Component Specifications
- Activity sharing preferences UI: Toggle sharing for check-ins, coupon redemptions, reviews, ad interactions. [Source: PRD]
- Coupon sharing activity is always public, but user can opt out of receiving shared coupons until accepted. [Source: PRD]

### File Locations
- Frontend pages: `apps/web/src/pages/activity-privacy.tsx`
- API service: `apps/web/src/api/activity-privacy.ts`
- Backend: `apps/api/src/users/` (serverless functions for activity privacy)
[Source: architecture/unified-project-structure.md]

### Testing Requirements
- Frontend: Unit and integration tests for activity sharing preferences UI. [Source: architecture/testing-strategy.md]
- Backend: Unit and integration tests for activity privacy endpoints. [Source: architecture/testing-strategy.md]
- E2E: Playwright/Cypress tests for activity privacy flows. [Source: architecture/testing-strategy.md]

### Technical Constraints
- TypeScript for all codebases. [Source: architecture/tech-stack.md]
- Follow coding standards for API service layer, error handling, and naming conventions. [Source: architecture/coding-standards.md]
- State management for activity privacy via React Context API/Zustand/Jotai. [Source: architecture/tech-stack.md]
- Coupon sharing activity must always be public, but opt-out for receiving shared coupons must be enforced. [Source: PRD]

## Tasks / Subtasks
1. Implement activity sharing preferences UI for users. [Source: PRD]
2. Implement backend endpoint for updating activity sharing preferences. [Source: PRD]
3. Store and retrieve activity sharing preferences in Users table. [Source: PRD]
4. Enforce coupon sharing activity as always public, but allow opt-out for receiving shared coupons. [Source: PRD]
5. Add validation and error handling for activity privacy settings. [Source: architecture/coding-standards.md]
6. Write unit/integration tests for frontend activity privacy UI. [Source: architecture/testing-strategy.md]
7. Write unit/integration tests for backend activity privacy endpoints. [Source: architecture/testing-strategy.md]
8. Write E2E tests for activity privacy flows. [Source: architecture/testing-strategy.md]
9. Verify all file locations and naming conventions match unified project structure. [Source: architecture/unified-project-structure.md]

## Project Structure Notes
- All files should be placed according to the unified project structure. [Source: architecture/unified-project-structure.md]
- No conflicts found between epic requirements and unified project structure.

---

Checklist: To be completed after draft review.
- [ ] All acceptance criteria addressed
- [ ] All technical context referenced
- [ ] Tasks/subtasks are actionable and referenced
- [ ] Project structure alignment verified
- [ ] Ready for developer implementation 