# Story 3.4: Friend System (Accept/Decline/Remove/Block) & Basic Activity Feed

**Status:** Draft

## Story Statement
As a user,
I want to manage my friend requests and existing friends, and see basic activity,
so that I can control my social network.

## Acceptance Criteria
- User can accept or decline pending friend requests.
- User can view a list of their accepted friends.
- User can remove or block existing friends.
- User can mark friends as 'most interacted favorites'.
- A basic activity feed displays friend requests and new friend connections.
- Friends table status is updated ('accepted', 'blocked'), accepted_at is set.
- Local Testability: API endpoint PUT /api/users/{user_id}/friends/{friend_id} updates friend status. Verification by querying SELECT status FROM public.Friends WHERE user_id = '{user_id}' AND friend_id = '{friend_id}'.

## Dev Notes
### Previous Story Insights
- Friend request and search system is in place. [Source: docs/stories/3.3.story.md]

### Data Models
- Friends table: user_id, friend_id, status ('accepted', 'blocked'), accepted_at, is_favorite. [Source: PRD]
- Activity feed: friend requests, new connections. [Source: PRD]

### API Specifications
- PUT /api/users/{user_id}/friends/{friend_id}: Update friend status (accept, decline, remove, block, favorite). [Source: PRD]
- GET /api/users/{user_id}/friends: Retrieve friend list and statuses. [Source: PRD]
- GET /api/users/{user_id}/activity-feed: Retrieve activity feed. [Source: PRD]
- All API interactions must go through frontend API service layer (`apps/web/src/api/`). [Source: architecture/coding-standards.md]

### Component Specifications
- Friend management UI: Accept/decline/remove/block/favorite actions. [Source: PRD]
- Activity feed UI: Display friend requests and new connections. [Source: PRD]

### File Locations
- Frontend pages: `apps/web/src/pages/friends.tsx`, `apps/web/src/pages/activity-feed.tsx`
- API service: `apps/web/src/api/friends.ts`, `apps/web/src/api/activity-feed.ts`
- Backend: `apps/api/src/users/` (serverless functions for friends and activity feed)
[Source: architecture/unified-project-structure.md]

### Testing Requirements
- Frontend: Unit and integration tests for friend management and activity feed UI. [Source: architecture/testing-strategy.md]
- Backend: Unit and integration tests for friends and activity feed endpoints. [Source: architecture/testing-strategy.md]
- E2E: Playwright/Cypress tests for friend management and activity feed flows. [Source: architecture/testing-strategy.md]

### Technical Constraints
- TypeScript for all codebases. [Source: architecture/tech-stack.md]
- Follow coding standards for API service layer, error handling, and naming conventions. [Source: architecture/coding-standards.md]
- State management for friends/activity feed via React Context API/Zustand/Jotai. [Source: architecture/tech-stack.md]

## Tasks / Subtasks
1. Implement friend management UI (accept/decline/remove/block/favorite). [Source: PRD]
2. Implement backend endpoints for updating friend status and retrieving friend list. [Source: PRD]
3. Implement activity feed UI and backend endpoint. [Source: PRD]
4. Store and retrieve friend and activity data in Friends table and activity feed. [Source: PRD]
5. Add validation and error handling for friend management actions. [Source: architecture/coding-standards.md]
6. Write unit/integration tests for frontend friend management and activity feed. [Source: architecture/testing-strategy.md]
7. Write unit/integration tests for backend friends and activity feed endpoints. [Source: architecture/testing-strategy.md]
8. Write E2E tests for friend management and activity feed flows. [Source: architecture/testing-strategy.md]
9. Verify all file locations and naming conventions match unified project structure. [Source: architecture/unified-project-structure.md]

## Project Structure Notes
- All files should be placed according to the unified project structure. [Source: architecture/unified-project-structure.md]
- No conflicts found between epic requirements and unified project structure.

---

Checklist: To be completed after draft review.
- [ ] All acceptance criteria addressed
- [ ] All technical context referenced
- [ ] Tasks/subtasks are actionable and referenced
- [ ] Project structure alignment verified
- [ ] Ready for developer implementation 