# Story 5.2: Real-time Offer & Promotion Notifications

**Status:** Draft

## Story Statement
As a user,
I want to receive real-time notifications about instant offers and business promotions,
so that I don't miss out on relevant deals.

## Acceptance Criteria
- User receives real-time notifications for new instant offers from businesses they follow or that match their interests/location.
- User receives real-time notifications for new business promotions from businesses they follow or that match their interests/location.
- Notifications include deep links directly to the relevant coupons or storefronts.
- Notification messages are limited to a maximum length of 20 words.
- Notifications table is populated with recipient_user_id, sender_business_id, notification_type ('offer_update', 'business_promotion'), message, deep_link_url.
- Local Testability: Simulate a notification trigger (e.g., via backend script/function) and verify a new entry in Notifications table for the target recipient_user_id.

## Dev Notes
### Previous Story Insights
- User feedback and review submission is in place. [Source: docs/stories/5.1.story.md]

### Data Models
- Notifications table: recipient_user_id, sender_business_id, notification_type, message, deep_link_url. [Source: PRD]

### API Specifications
- POST /api/notifications/offer: Triggers an offer notification. [Source: PRD]
- POST /api/notifications/promotion: Triggers a promotion notification. [Source: PRD]
- All API interactions must go through frontend API service layer (`apps/web/src/api/`). [Source: architecture/coding-standards.md]

### Component Specifications
- Notification UI: Real-time popups, notification center, deep links to coupons/storefronts. [Source: PRD]
- Notification message length enforcement. [Source: PRD]

### File Locations
- Frontend pages: `apps/web/src/pages/notifications.tsx`
- API service: `apps/web/src/api/notifications.ts`
- Backend: `apps/api/src/notifications/` (serverless functions for notifications)
[Source: architecture/unified-project-structure.md]

### Testing Requirements
- Frontend: Unit and integration tests for notification UI and deep linking. [Source: architecture/testing-strategy.md]
- Backend: Unit and integration tests for notification endpoints. [Source: architecture/testing-strategy.md]
- E2E: Playwright/Cypress tests for notification delivery and display. [Source: architecture/testing-strategy.md]

### Technical Constraints
- TypeScript for all codebases. [Source: architecture/tech-stack.md]
- Follow coding standards for API service layer, error handling, and naming conventions. [Source: architecture/coding-standards.md]
- State management for notifications via React Context API/Zustand/Jotai. [Source: architecture/tech-stack.md]
- Real-time delivery must be reliable and scalable. [Source: PRD]

## Tasks / Subtasks
1. Implement backend endpoints for triggering offer and promotion notifications. [Source: PRD]
2. Store and retrieve notifications in Notifications table. [Source: PRD]
3. Implement frontend notification UI with real-time popups and notification center. [Source: PRD]
4. Enforce message length and deep linking in notifications. [Source: PRD]
5. Add validation and error handling for notification delivery. [Source: architecture/coding-standards.md]
6. Write unit/integration tests for frontend notification UI and deep linking. [Source: architecture/testing-strategy.md]
7. Write unit/integration tests for backend notification endpoints. [Source: architecture/testing-strategy.md]
8. Write E2E tests for notification delivery and display. [Source: architecture/testing-strategy.md]
9. Verify all file locations and naming conventions match unified project structure. [Source: architecture/unified-project-structure.md]

## Project Structure Notes
- All files should be placed according to the unified project structure. [Source: architecture/unified-project-structure.md]
- No conflicts found between epic requirements and unified project structure.

---

Checklist: To be completed after draft review.
- [ ] All acceptance criteria addressed
- [ ] All technical context referenced
- [ ] Tasks/subtasks are actionable and referenced
- [ ] Project structure alignment verified
- [ ] Ready for developer implementation 