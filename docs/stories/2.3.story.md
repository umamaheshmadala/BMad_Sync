# Story 2.3: User City & Interest Selection

**Status:** Approved

## Story Statement
As a new user,
I want to select my city and interests,
so that I can receive personalized and relevant updates.

## Acceptance Criteria
- Upon first login, the user is prompted to select their primary city.
- Upon first login, the user is prompted to choose a minimum of five interests.
- User can select/update their interests and city at any point in time from their profile settings.
- Selected city and interests are saved to the user's profile.
- Users table city and interests fields are updated.
- Local Testability: API endpoint PUT /api/users/{user_id}/profile/interests updates interests, returning 200 OK. Verification by querying SELECT city, interests FROM public.Users WHERE user_id = '{user_id}'.

## Dev Notes
### Previous Story Insights
- User authentication and profile management are in place. [Source: docs/stories/1.2.story.md, docs/stories/1.3.story.md]

### Data Models
- Users table: city, interests fields added/updated. [Source: PRD]
- Profile form fields: city selection, interests (multi-select, minimum 5). [Source: PRD]

### API Specifications
- PUT /api/users/{user_id}/profile/interests: Updates city and interests. [Source: PRD]
- GET /api/users/{user_id}/profile: Retrieves user profile including city and interests. [Source: PRD]
- All API interactions must go through frontend API service layer (`apps/web/src/api/`). [Source: architecture/coding-standards.md]

### Component Specifications
- City and interest selection prompt on first login. [Source: PRD]
- Profile settings page for updating city/interests. [Source: PRD]
- Multi-select UI for interests (minimum 5 required). [Source: PRD]

### File Locations
- Frontend pages: `apps/web/src/pages/onboarding-city-interests.tsx`, `apps/web/src/pages/profile-settings.tsx`
- API service: `apps/web/src/api/user.ts`
- Backend: `apps/api/src/users/` (serverless functions for profile management)
[Source: architecture/unified-project-structure.md]

### Testing Requirements
- Frontend: Unit and integration tests for city/interest selection and profile update. [Source: architecture/testing-strategy.md]
- Backend: Unit and integration tests for profile endpoints. [Source: architecture/testing-strategy.md]
- E2E: Playwright/Cypress tests for onboarding and profile update flows. [Source: architecture/testing-strategy.md]

### Technical Constraints
- TypeScript for all codebases. [Source: architecture/tech-stack.md]
- Follow coding standards for API service layer, error handling, and naming conventions. [Source: architecture/coding-standards.md]
- State management for onboarding/profile via React Context API/Zustand/Jotai. [Source: architecture/tech-stack.md]

## Tasks / Subtasks
1. Implement onboarding prompt for city and interest selection on first login. [Source: PRD]
2. Create multi-select UI for interests (minimum 5 required). [Source: PRD]
3. Implement profile settings page for updating city/interests. [Source: PRD]
4. Implement backend endpoints for updating/retrieving city and interests. [Source: PRD]
5. Store and retrieve city/interests in Users table. [Source: PRD]
6. Add validation and error handling for city/interest selection. [Source: architecture/coding-standards.md]
7. Write unit/integration tests for frontend onboarding and profile update. [Source: architecture/testing-strategy.md]
8. Write unit/integration tests for backend profile endpoints. [Source: architecture/testing-strategy.md]
9. Write E2E tests for onboarding and profile update flows. [Source: architecture/testing-strategy.md]
10. Verify all file locations and naming conventions match unified project structure. [Source: architecture/unified-project-structure.md]

## Project Structure Notes
- All files should be placed according to the unified project structure. [Source: architecture/unified-project-structure.md]
- No conflicts found between epic requirements and unified project structure.

---

Checklist: To be completed after draft review.
- [ ] All acceptance criteria addressed
- [ ] All technical context referenced
- [ ] Tasks/subtasks are actionable and referenced
- [ ] Project structure alignment verified
- [ ] Ready for developer implementation 