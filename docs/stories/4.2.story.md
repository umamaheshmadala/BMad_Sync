# Story 4.2: Business Analytics Dashboard (Performance Trends & Recommendations)

**Status:** Draft

## Story Statement
As a business owner,
I want to see trends of my peer's performance and receive marketing recommendations,
so that I can benchmark my business and refine my strategies.

## Acceptance Criteria
- Dashboard displays trends of peer's performance for businesses within similar categories.
- Dashboard displays marketing effectiveness metrics for all generated ads, offers, promotions, and coupons.
- Dashboard provides marketing recommendations based on the analyzed analytics data.
- Businesses can use these analytics to take actions such as sending follow-up coupons, creating new offers based on customer response, curating needs/interests, identifying Drivers, and phasing out underperforming marketing.
- Data from Ads, Promotions, Coupons tables, and UserActivities (ad views, clicks, impressions, engagement duration, coupon collections, storefront visits, top product interactions) is utilized for these analytics.
- Local Testability: API endpoint GET /api/business/{business_id}/analytics/trends returns peer and marketing trends data. Verification by checking returned JSON structure against expected metrics derived from Ads, Promotions, UserActivities data.

## Dev Notes
### Previous Story Insights
- Business analytics dashboard for reviews and coupon utilization is in place. [Source: docs/stories/4.1.story.md]

### Data Models
- Ads table: business_id, title, description, target_parameters, start_date, end_date, ad_type, image_url, cost_per_day. [Source: PRD]
- Promotions table: business_id, title, description, target_parameters, start_date, end_date. [Source: PRD]
- Coupons table: coupon_id, offer_id, business_id, value, start_date, end_date, total_quantity, cost_per_coupon. [Source: PRD]
- UserActivities table: activity_type (ad views, clicks, impressions, engagement duration, coupon collections, storefront visits, top product interactions), entity_id, activity_data. [Source: PRD]

### API Specifications
- GET /api/business/{business_id}/analytics/trends: Returns peer and marketing trends data. [Source: PRD]
- All API interactions must go through frontend API service layer (`apps/web/src/api/`). [Source: architecture/coding-standards.md]

### Component Specifications
- Analytics dashboard UI: Peer performance trends, marketing effectiveness metrics, recommendations, actionable insights. [Source: PRD]

### File Locations
- Frontend pages: `apps/web/src/pages/business-analytics-dashboard.tsx`
- API service: `apps/web/src/api/business-analytics.ts`
- Backend: `apps/api/src/business/` (serverless functions for analytics)
[Source: architecture/unified-project-structure.md]

### Testing Requirements
- Frontend: Unit and integration tests for analytics dashboard UI (trends, recommendations). [Source: architecture/testing-strategy.md]
- Backend: Unit and integration tests for analytics endpoints. [Source: architecture/testing-strategy.md]
- E2E: Playwright/Cypress tests for analytics dashboard flows. [Source: architecture/testing-strategy.md]

### Technical Constraints
- TypeScript for all codebases. [Source: architecture/tech-stack.md]
- Follow coding standards for API service layer, error handling, and naming conventions. [Source: architecture/coding-standards.md]
- State management for analytics dashboard via React Context API/Zustand/Jotai. [Source: architecture/tech-stack.md]
- Analytics calculations must be efficient and scalable. [Source: PRD]

## Tasks / Subtasks
1. Implement analytics dashboard UI for peer trends, marketing metrics, and recommendations. [Source: PRD]
2. Implement backend endpoint for peer and marketing trends analytics. [Source: PRD]
3. Aggregate and calculate trends and recommendations from Ads, Promotions, Coupons, and UserActivities tables. [Source: PRD]
4. Add actionable insights and recommendations UI. [Source: PRD]
5. Add validation and error handling for analytics data. [Source: architecture/coding-standards.md]
6. Write unit/integration tests for frontend analytics dashboard. [Source: architecture/testing-strategy.md]
7. Write unit/integration tests for backend analytics endpoints. [Source: architecture/testing-strategy.md]
8. Write E2E tests for analytics dashboard flows. [Source: architecture/testing-strategy.md]
9. Verify all file locations and naming conventions match unified project structure. [Source: architecture/unified-project-structure.md]

## Project Structure Notes
- All files should be placed according to the unified project structure. [Source: architecture/unified-project-structure.md]
- No conflicts found between epic requirements and unified project structure.

---

Checklist: To be completed after draft review.
- [ ] All acceptance criteria addressed
- [ ] All technical context referenced
- [ ] Tasks/subtasks are actionable and referenced
- [ ] Project structure alignment verified
- [ ] Ready for developer implementation 