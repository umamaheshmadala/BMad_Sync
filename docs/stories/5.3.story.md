# Story 5.3: Real-time Social & Activity Notifications

**Status:** Draft

## Story Statement
As a user,
I want to receive real-time notifications about social events and friend activities,
so that I stay connected with my network.

## Acceptance Criteria
- User receives real-time notifications for new friend requests.
- User receives real-time notifications when friends accept their shared coupons.
- User receives real-time notifications when a shared coupon is accepted or declined by the receiver, notifying the sender.
- User receives real-time notifications when a coupon they shared is redeemed by a direct friend.
- User receives real-time notifications when a coupon they shared is redeemed by a 2nd, 3rd, or subsequent connection, labeled as "coupon redeemed by [number]th connection", where the number indicates how many users the coupon has been shared with.
- Notifications table is populated with recipient_user_id, notification_type ('friend_request', 'coupon_share_accepted', 'coupon_share_declined', 'coupon_redeemed_by_friend', 'coupon_redeemed_by_nth_connection').
- Local Testability: Simulate social events (e.g., friend request, coupon share acceptance) via backend calls/scripts and verify corresponding entries in Notifications table.

## Dev Notes
### Previous Story Insights
- Real-time offer and promotion notifications are in place. [Source: docs/stories/5.2.story.md]

### Data Models
- Notifications table: recipient_user_id, notification_type, message, related_entity_id, created_at. [Source: PRD]

### API Specifications
- POST /api/notifications/social: Triggers a social/activity notification. [Source: PRD]
- All API interactions must go through frontend API service layer (`apps/web/src/api/`). [Source: architecture/coding-standards.md]

### Component Specifications
- Notification UI: Real-time popups, notification center, activity feed integration. [Source: PRD]
- Notification message formatting for nth connection. [Source: PRD]

### File Locations
- Frontend pages: `apps/web/src/pages/notifications.tsx`, `apps/web/src/pages/activity-feed.tsx`
- API service: `apps/web/src/api/notifications.ts`
- Backend: `apps/api/src/notifications/` (serverless functions for notifications)
[Source: architecture/unified-project-structure.md]

### Testing Requirements
- Frontend: Unit and integration tests for notification UI and activity feed. [Source: architecture/testing-strategy.md]
- Backend: Unit and integration tests for notification endpoints. [Source: architecture/testing-strategy.md]
- E2E: Playwright/Cypress tests for notification delivery and activity feed display. [Source: architecture/testing-strategy.md]

### Technical Constraints
- TypeScript for all codebases. [Source: architecture/tech-stack.md]
- Follow coding standards for API service layer, error handling, and naming conventions. [Source: architecture/coding-standards.md]
- State management for notifications/activity feed via React Context API/Zustand/Jotai. [Source: architecture/tech-stack.md]
- Real-time delivery must be reliable and scalable. [Source: PRD]

## Tasks / Subtasks
1. Implement backend endpoint for triggering social/activity notifications. [Source: PRD]
2. Store and retrieve notifications in Notifications table. [Source: PRD]
3. Implement frontend notification UI and activity feed integration. [Source: PRD]
4. Format notification messages for nth connection redemption. [Source: PRD]
5. Add validation and error handling for notification delivery. [Source: architecture/coding-standards.md]
6. Write unit/integration tests for frontend notification UI and activity feed. [Source: architecture/testing-strategy.md]
7. Write unit/integration tests for backend notification endpoints. [Source: architecture/testing-strategy.md]
8. Write E2E tests for notification delivery and activity feed display. [Source: architecture/testing-strategy.md]
9. Verify all file locations and naming conventions match unified project structure. [Source: architecture/unified-project-structure.md]

## Project Structure Notes
- All files should be placed according to the unified project structure. [Source: architecture/unified-project-structure.md]
- No conflicts found between epic requirements and unified project structure.

---

Checklist: To be completed after draft review.
- [ ] All acceptance criteria addressed
- [ ] All technical context referenced
- [ ] Tasks/subtasks are actionable and referenced
- [ ] Project structure alignment verified
- [ ] Ready for developer implementation 