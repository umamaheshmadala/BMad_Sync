# Story 5.6: Wishlist Offer & Coupon Matching Notifications

**Status:** Approved

## Story Statement
As a user,
I want to be notified when items on my Wishlist match new offers or coupons,
so that I can capitalize on potential savings.

## Acceptance Criteria
- The system identifies when a Wishlist item's categorization matches an active offer or coupon from a business.
- User receives a notification when a match is found.
- The notification links directly to the relevant coupon or business storefront.
- User can tag the matched coupon or offer to the Wishlist item for future reference.
- WishlistMatches table tracks wishlist_item_id, coupon_id/offer_id, business_id, matched_at, and notification_sent_at.
- Local Testability: Simulate a Wishlist match event via backend script/function and verify a new entry in WishlistMatches and Notifications tables for the target user_id.

## Dev Notes
### Previous Story Insights
- Wishlist and notification systems are in place. [Source: docs/stories/2.6.story.md, docs/stories/5.2.story.md]

### Data Models
- WishlistMatches table: wishlist_item_id, coupon_id/offer_id, business_id, matched_at, notification_sent_at. [Source: PRD]
- Notifications table: recipient_user_id, notification_type, message, deep_link_url, created_at. [Source: PRD]

### API Specifications
- POST /api/wishlist/match: Triggers a wishlist match event. [Source: PRD]
- All API interactions must go through frontend API service layer (`apps/web/src/api/`). [Source: architecture/coding-standards.md]

### Component Specifications
- Notification UI: Real-time notification for wishlist matches, deep link to coupon/storefront. [Source: PRD]
- Wishlist UI: Tagging matched coupons/offers to wishlist items. [Source: PRD]

### File Locations
- Frontend pages: `apps/web/src/pages/wishlist.tsx`, `apps/web/src/pages/notifications.tsx`
- API service: `apps/web/src/api/wishlist.ts`, `apps/web/src/api/notifications.ts`
- Backend: `apps/api/src/wishlist/`, `apps/api/src/notifications/` (serverless functions for wishlist matching and notifications)
[Source: architecture/unified-project-structure.md]

### Testing Requirements
- Frontend: Unit and integration tests for wishlist match notifications and tagging UI. [Source: architecture/testing-strategy.md]
- Backend: Unit and integration tests for wishlist match and notification endpoints. [Source: architecture/testing-strategy.md]
- E2E: Playwright/Cypress tests for wishlist match notification and tagging flows. [Source: architecture/testing-strategy.md]

### Technical Constraints
- TypeScript for all codebases. [Source: architecture/tech-stack.md]
- Follow coding standards for API service layer, error handling, and naming conventions. [Source: architecture/coding-standards.md]
- State management for wishlist/notifications via React Context API/Zustand/Jotai. [Source: architecture/tech-stack.md]
- Matching logic must be efficient and accurate. [Source: PRD]

## Tasks / Subtasks
1. Implement backend endpoint for triggering wishlist match events. [Source: PRD]
2. Store and retrieve matches in WishlistMatches table. [Source: PRD]
3. Implement frontend notification UI for wishlist matches with deep linking. [Source: PRD]
4. Implement tagging of matched coupons/offers to wishlist items in UI. [Source: PRD]
5. Add validation and error handling for matching and notifications. [Source: architecture/coding-standards.md]
6. Write unit/integration tests for frontend wishlist match notifications and tagging UI. [Source: architecture/testing-strategy.md]
7. Write unit/integration tests for backend wishlist match and notification endpoints. [Source: architecture/testing-strategy.md]
8. Write E2E tests for wishlist match notification and tagging flows. [Source: architecture/testing-strategy.md]
9. Verify all file locations and naming conventions match unified project structure. [Source: architecture/unified-project-structure.md]

## Project Structure Notes
- All files should be placed according to the unified project structure. [Source: architecture/unified-project-structure.md]
- No conflicts found between epic requirements and unified project structure.

---

Checklist: To be completed after draft review.
- [ ] All acceptance criteria addressed
- [ ] All technical context referenced
- [ ] Tasks/subtasks are actionable and referenced
- [ ] Project structure alignment verified
- [ ] Ready for developer implementation 