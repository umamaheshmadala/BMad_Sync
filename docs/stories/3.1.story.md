# Story 3.1: Business Offer & Coupon Creation

**Status:** Draft

## Story Statement
As a business owner,
I want to create and publish offers and generate coupons with defined terms and conditions,
so that I can attract and incentivize users.

## Acceptance Criteria
- Business owner can access an interface to create new offers.
- Business owner can generate coupons linked to specific offers, defining quantity, start/end dates, and terms/conditions.
- The system handles billing for coupon generation on a postpaid basis, following the Google Ads model (validating card and keeping it for postpaid bills).
- Error messages related to payment issues will follow Google Ads examples (e.g., "Issue with the payment. Please update the payment method").
- Business owner can define minimum number of coupons (e.g., 50 coupons) and minimum batch size of 100 for generation.
- Coupons table is populated with business_id, title, description, terms_and_conditions, value, start_date, end_date, total_quantity, cost_per_coupon.
- Local Testability: API endpoint POST /api/business/offers creates an offer and POST /api/business/offers/{offer_id}/coupons generates coupons, both returning 201 Created. Verification by querying SELECT * FROM public.Coupons WHERE business_id = '{business_id}' AND title = '{coupon_title}'.

## Dev Notes
### Previous Story Insights
- Business storefront and product management are in place. [Source: docs/stories/2.1.story.md, docs/stories/2.2.story.md]

### Data Models
- Offers table: offer_id, business_id, title, description, terms_and_conditions, start_date, end_date, total_quantity, cost_per_coupon. [Source: PRD]
- Coupons table: coupon_id, offer_id, business_id, value, start_date, end_date, total_quantity, cost_per_coupon. [Source: PRD]

### API Specifications
- POST /api/business/offers: Creates a new offer. [Source: PRD]
- POST /api/business/offers/{offer_id}/coupons: Generates coupons for an offer. [Source: PRD]
- All API interactions must go through frontend API service layer (`apps/web/src/api/`). [Source: architecture/coding-standards.md]

### Component Specifications
- Offer creation interface: Form for offer details, terms, and coupon generation. [Source: PRD]
- Coupon generation interface: Quantity, batch size, start/end dates, terms/conditions. [Source: PRD]
- Payment method validation and error display. [Source: PRD]

### File Locations
- Frontend pages: `apps/web/src/pages/business-offers.tsx`, `apps/web/src/pages/business-coupons.tsx`
- API service: `apps/web/src/api/offers.ts`, `apps/web/src/api/coupons.ts`
- Backend: `apps/api/src/business/` (serverless functions for offers and coupons)
[Source: architecture/unified-project-structure.md]

### Testing Requirements
- Frontend: Unit and integration tests for offer/coupon creation and payment handling. [Source: architecture/testing-strategy.md]
- Backend: Unit and integration tests for offer/coupon endpoints. [Source: architecture/testing-strategy.md]
- E2E: Playwright/Cypress tests for offer/coupon creation and payment flows. [Source: architecture/testing-strategy.md]

### Technical Constraints
- TypeScript for all codebases. [Source: architecture/tech-stack.md]
- Follow coding standards for API service layer, error handling, and naming conventions. [Source: architecture/coding-standards.md]
- State management for offers/coupons via React Context API/Zustand/Jotai. [Source: architecture/tech-stack.md]
- Payment handling must follow Google Ads postpaid model. [Source: PRD]

## Tasks / Subtasks
1. Implement offer creation interface for business owners. [Source: PRD]
2. Implement coupon generation interface with quantity, batch size, start/end dates, and terms/conditions. [Source: PRD]
3. Integrate payment method validation and error handling (Google Ads model). [Source: PRD]
4. Implement backend endpoints for offer and coupon creation. [Source: PRD]
5. Store and retrieve offers/coupons in Offers and Coupons tables. [Source: PRD]
6. Add validation and error handling for offer/coupon creation and payment. [Source: architecture/coding-standards.md]
7. Write unit/integration tests for frontend offer/coupon creation and payment. [Source: architecture/testing-strategy.md]
8. Write unit/integration tests for backend offer/coupon endpoints. [Source: architecture/testing-strategy.md]
9. Write E2E tests for offer/coupon creation and payment flows. [Source: architecture/testing-strategy.md]
10. Verify all file locations and naming conventions match unified project structure. [Source: architecture/unified-project-structure.md]

## Project Structure Notes
- All files should be placed according to the unified project structure. [Source: architecture/unified-project-structure.md]
- No conflicts found between epic requirements and unified project structure.

---

Checklist: To be completed after draft review.
- [ ] All acceptance criteria addressed
- [ ] All technical context referenced
- [ ] Tasks/subtasks are actionable and referenced
- [ ] Project structure alignment verified
- [ ] Ready for developer implementation 