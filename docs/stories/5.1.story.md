# Story 5.1: User Feedback & Review Submission

**Status:** Approved

## Story Statement
As a user,
I want to provide feedback and brief reviews for businesses,
so that I can share my experiences and contribute to business insights.

## Acceptance Criteria
- User can submit feedback for businesses using only two options: "recommend" (Thumbs up) or "don't recommend (thumbs down)".
- User can submit a brief review for a business, limited to a maximum of 30 words.
- Users are only eligible to leave a review for a business if they have a recorded check-in (GPS-based or coupon redemption-triggered) at that business.
- User can view their own submitted reviews.
- BusinessReviews table is populated with business_id, user_id, recommend_status, review_text, and checked_in_at.
- Local Testability: API endpoint POST /api/business/{business_id}/reviews submits a review, returning 201 Created. Verification by querying SELECT review_text, recommend_status FROM public.BusinessReviews WHERE business_id = '{business_id}' AND user_id = '{user_id}'.

## Dev Notes
### Previous Story Insights
- Check-in and coupon redemption logic are in place. [Source: docs/stories/3.6.story.md, docs/stories/3.7.story.md]

### Data Models
- BusinessReviews table: business_id, user_id, recommend_status, review_text, checked_in_at. [Source: PRD]

### API Specifications
- POST /api/business/{business_id}/reviews: Submits a review. [Source: PRD]
- GET /api/business/{business_id}/reviews: Retrieves reviews for a business. [Source: PRD]
- All API interactions must go through frontend API service layer (`apps/web/src/api/`). [Source: architecture/coding-standards.md]

### Component Specifications
- Review submission UI: Thumbs up/down, 30-word text input, submit button. [Source: PRD]
- Review display UI: List of user's own reviews. [Source: PRD]
- Eligibility logic for review submission (check-in required). [Source: PRD]

### File Locations
- Frontend pages: `apps/web/src/pages/business-reviews.tsx`, `apps/web/src/pages/my-reviews.tsx`
- API service: `apps/web/src/api/reviews.ts`
- Backend: `apps/api/src/business/` (serverless functions for reviews)
[Source: architecture/unified-project-structure.md]

### Testing Requirements
- Frontend: Unit and integration tests for review submission and display UI. [Source: architecture/testing-strategy.md]
- Backend: Unit and integration tests for review endpoints. [Source: architecture/testing-strategy.md]
- E2E: Playwright/Cypress tests for review submission and eligibility flows. [Source: architecture/testing-strategy.md]

### Technical Constraints
- TypeScript for all codebases. [Source: architecture/tech-stack.md]
- Follow coding standards for API service layer, error handling, and naming conventions. [Source: architecture/coding-standards.md]
- State management for reviews via React Context API/Zustand/Jotai. [Source: architecture/tech-stack.md]
- Eligibility logic for review submission must be enforced in backend. [Source: PRD]

## Tasks / Subtasks
1. Implement review submission UI (thumbs up/down, 30-word text input, submit button). [Source: PRD]
2. Implement backend endpoints for review submission and retrieval. [Source: PRD]
3. Store and retrieve reviews in BusinessReviews table. [Source: PRD]
4. Enforce eligibility logic for review submission (check-in required). [Source: PRD]
5. Implement review display UI for user's own reviews. [Source: PRD]
6. Add validation and error handling for review submission. [Source: architecture/coding-standards.md]
7. Write unit/integration tests for frontend review submission and display UI. [Source: architecture/testing-strategy.md]
8. Write unit/integration tests for backend review endpoints. [Source: architecture/testing-strategy.md]
9. Write E2E tests for review submission and eligibility flows. [Source: architecture/testing-strategy.md]
10. Verify all file locations and naming conventions match unified project structure. [Source: architecture/unified-project-structure.md]

## Project Structure Notes
- All files should be placed according to the unified project structure. [Source: architecture/unified-project-structure.md]
- No conflicts found between epic requirements and unified project structure.

---

Checklist: To be completed after draft review.
- [ ] All acceptance criteria addressed
- [ ] All technical context referenced
- [ ] Tasks/subtasks are actionable and referenced
- [ ] Project structure alignment verified
- [ ] Ready for developer implementation 