# Story 2.2: Business Storefront Product Display

**Status:** Done

## Story Statement
As a business owner,
I want to display my top/new/trending/customer favorite products on my storefront,
so that users can get a brief idea of what to expect.

## Acceptance Criteria
- Business owner can manually select and arrange between 4 and 10 products for display on their storefront.
- Business owner can change their displayed products anytime.
- Each displayed product can have a name, description, and image.
- The system provides suggestions for trending products (e.g., based on product searches, category searches, coupon categories, user interests, products in user wish lists) to the business owner.
- Products are displayed on the business's storefront page.
- StorefrontProducts table is populated with storefront_id, product_name, product_description, product_image_url, display_order, and is_trending flag for suggested items.
- Local Testability: API endpoint POST /api/storefronts/{storefront_id}/products adds products, returning 200 OK. Verification by querying SELECT * FROM public.StorefrontProducts WHERE storefront_id = '{storefront_id}'.

## Dev Notes
### Previous Story Insights
- Storefront management and branding are in place. [Source: docs/stories/2.1.story.md]

### Data Models
- Storefronts table: storefront_id, business_id, description, theme, branding content, open/close status, promotional banners. [Source: PRD]
- Product selection and arrangement logic. [Source: PRD]

### API Specifications
- POST /api/storefronts/{storefront_id}/products: Adds/updates displayed products. [Source: PRD]
- GET /api/storefronts/{storefront_id}/products: Retrieves displayed products. [Source: PRD]
- All API interactions must go through frontend API service layer (`apps/web/src/api/`). [Source: architecture/coding-standards.md]

### Component Specifications
- Product selection/arrangement interface for business owners. [Source: PRD]
- Product display component on storefront page. [Source: PRD]
- Trending product suggestions UI. [Source: PRD]

### File Locations
- Frontend pages: `apps/web/src/pages/business-storefront-products.tsx`
- API service: `apps/web/src/api/storefront-products.ts`
- Backend: `apps/api/src/storefronts/` (serverless functions for product display)
[Source: architecture/unified-project-structure.md]

### Testing Requirements
- Frontend: Unit and integration tests for product selection/arrangement and display. [Source: architecture/testing-strategy.md]
- Backend: Unit and integration tests for storefront product endpoints. [Source: architecture/testing-strategy.md]
- E2E: Playwright/Cypress tests for product display and arrangement. [Source: architecture/testing-strategy.md]

### Technical Constraints
- Use Supabase Storage for product images. [Source: architecture/tech-stack.md]
- TypeScript for all codebases. [Source: architecture/tech-stack.md]
- Follow coding standards for API service layer, error handling, and naming conventions. [Source: architecture/coding-standards.md]
- State management for storefront products via React Context API/Zustand/Jotai. [Source: architecture/tech-stack.md]

## Tasks / Subtasks
1. Create product selection/arrangement interface for business owners. [Source: PRD]
2. Implement backend endpoints for adding/updating displayed products. [Source: PRD]
3. Store and retrieve product data from StorefrontProducts table. [Source: PRD]
4. Integrate Supabase Storage for product images. [Source: architecture/tech-stack.md]
5. Display selected products on storefront page. [Source: PRD]
6. Implement trending product suggestion logic and UI. [Source: PRD]
7. Add validation and error handling for product selection/arrangement. [Source: architecture/coding-standards.md]
8. Write unit/integration tests for frontend product selection and display. [Source: architecture/testing-strategy.md]
9. Write unit/integration tests for backend product endpoints. [Source: architecture/testing-strategy.md]
10. Write E2E tests for product display and arrangement. [Source: architecture/testing-strategy.md]
11. Verify all file locations and naming conventions match unified project structure. [Source: architecture/unified-project-structure.md]

## Project Structure Notes
- All files should be placed according to the unified project structure. [Source: architecture/unified-project-structure.md]
- No conflicts found between epic requirements and unified project structure.

---

Checklist: To be completed after draft review.
- [ ] All acceptance criteria addressed
- [ ] All technical context referenced
- [ ] Tasks/subtasks are actionable and referenced
- [ ] Project structure alignment verified
- [ ] Ready for developer implementation 

## Dev Agent Record
### Agent Model Used
- Gemini 2.5 Flash

### Debug Log References
- Frontend product selection interface: apps/web/src/pages/business-storefront-products.tsx
- Backend product endpoints: apps/api/src/storefronts/products.ts
- Storefront display with products: apps/web/src/pages/business-storefront.tsx
- Frontend product selection tests: apps/web/src/pages/edit-business-storefront-products.test.tsx
- Backend product endpoint tests: apps/api/src/storefronts/tests/products.test.ts
- E2E product tests: e2e/business-storefront-products.spec.ts
- Trending product API: apps/api/src/storefronts/trending.ts

### Completion Notes List
- All tasks for Story 2.2 successfully implemented and verified.
- Product selection/arrangement interface for business owners is implemented in `apps/web/src/pages/business-storefront-products.tsx`.
- Backend endpoints for adding/updating displayed products are implemented in `apps/api/src/storefronts/products.ts`.
- Product data is stored and retrieved from the `StorefrontProducts` table.
- Supabase Storage is integrated for product images.
- Selected products are displayed on the storefront page (`apps/web/src/pages/business-storefront.tsx`).
- Trending product suggestion logic and UI are implemented in `apps/web/src/pages/business-storefront-products.tsx` and `apps/api/src/storefronts/trending.ts`.
- Validation and error handling for product selection/arrangement are added to `apps/web/src/pages/business-storefront-products.tsx`.
- Unit/integration tests for frontend product selection and display are in `apps/web/src/pages/edit-business-storefront-products.test.tsx`.
- Unit/integration tests for backend product endpoints are in `apps/api/src/storefronts/tests/products.test.ts`.
- E2E tests for product display and arrangement are in `e2e/business-storefront-products.spec.ts`.
- All file locations and naming conventions match the unified project structure as specified.

### File List
- `apps/web/src/pages/business-storefront-products.tsx` (new)
- `apps/api/src/storefronts/products.ts` (new)
- `apps/web/src/pages/business-storefront.tsx` (modified)
- `apps/api/src/storefronts/trending.ts` (new)
- `apps/web/src/pages/edit-business-storefront-products.test.tsx` (new)
- `apps/api/src/storefronts/tests/products.test.ts` (new)
- `e2e/business-storefront-products.spec.ts` (new)

### Change Log
- Implemented product selection/arrangement interface.
- Integrated Supabase Storage for product images.
- Implemented backend API for product management.
- Displayed selected products on storefront.
- Implemented trending product suggestions.
- Added frontend form validations.
- Added comprehensive unit, integration, and E2E tests. 