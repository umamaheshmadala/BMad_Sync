# Story 3.7: GPS-Based Check-in

**Status:** Draft

## Story Statement
As a user,
I want to check-in to a business via GPS,
so that my visit is recorded and I am eligible to leave a review.

## Acceptance Criteria
- User can initiate a GPS-based check-in at a business.
- System verifies user's proximity to the business's registered location using GPS.
- Upon successful GPS verification, a check-in is recorded for the user at the business.
- Only users with recorded check-ins (GPS-based or coupon redemption-triggered) are eligible to leave reviews for that business.
- UserActivities table is updated with activity_type 'check_in' and relevant entity_id (business_id) and activity_data including occurred_at.
- Local Testability: API endpoint POST /api/users/{user_id}/checkin/gps records a GPS check-in, returning 200 OK. Verification by querying SELECT * FROM public.UserActivities WHERE user_id = '{user_id}' AND activity_type = 'check_in'.

## Dev Notes
### Previous Story Insights
- Coupon redemption and check-in logic are in place. [Source: docs/stories/3.6.story.md]

### Data Models
- UserActivities table: activity_type 'check_in', entity_id (business_id), activity_data (occurred_at). [Source: PRD]

### API Specifications
- POST /api/users/{user_id}/checkin/gps: Records a GPS check-in. [Source: PRD]
- All API interactions must go through frontend API service layer (`apps/web/src/api/`). [Source: architecture/coding-standards.md]

### Component Specifications
- GPS check-in UI: Initiate check-in, display proximity status, confirmation. [Source: PRD]
- Review eligibility logic based on check-in status. [Source: PRD]

### File Locations
- Frontend pages: `apps/web/src/pages/checkin.tsx`, `apps/web/src/pages/review.tsx`
- API service: `apps/web/src/api/checkin.ts`
- Backend: `apps/api/src/users/` (serverless functions for check-in)
[Source: architecture/unified-project-structure.md]

### Testing Requirements
- Frontend: Unit and integration tests for GPS check-in and review eligibility UI. [Source: architecture/testing-strategy.md]
- Backend: Unit and integration tests for check-in endpoints. [Source: architecture/testing-strategy.md]
- E2E: Playwright/Cypress tests for check-in and review flows. [Source: architecture/testing-strategy.md]

### Technical Constraints
- TypeScript for all codebases. [Source: architecture/tech-stack.md]
- Follow coding standards for API service layer, error handling, and naming conventions. [Source: architecture/coding-standards.md]
- State management for check-in/review via React Context API/Zustand/Jotai. [Source: architecture/tech-stack.md]
- GPS verification logic must be secure and accurate. [Source: PRD]

## Tasks / Subtasks
1. Implement GPS check-in UI for business locations. [Source: PRD]
2. Implement backend endpoint for GPS check-in and proximity verification. [Source: PRD]
3. Store and update check-in data in UserActivities table. [Source: PRD]
4. Implement review eligibility logic based on check-in status. [Source: PRD]
5. Add validation and error handling for check-in and review. [Source: architecture/coding-standards.md]
6. Write unit/integration tests for frontend check-in and review UI. [Source: architecture/testing-strategy.md]
7. Write unit/integration tests for backend check-in endpoints. [Source: architecture/testing-strategy.md]
8. Write E2E tests for check-in and review flows. [Source: architecture/testing-strategy.md]
9. Verify all file locations and naming conventions match unified project structure. [Source: architecture/unified-project-structure.md]

## Project Structure Notes
- All files should be placed according to the unified project structure. [Source: architecture/unified-project-structure.md]
- No conflicts found between epic requirements and unified project structure.

---

Checklist: To be completed after draft review.
- [ ] All acceptance criteria addressed
- [ ] All technical context referenced
- [ ] Tasks/subtasks are actionable and referenced
- [ ] Project structure alignment verified
- [ ] Ready for developer implementation 